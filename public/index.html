<!DOCTYPE html>
<html>
	<head>
		<title> piracy huehuehue </title>
		<link rel="stylesheet" href="style.css">
	</head>

	<body>
		<main>
			<div class="insertURL">
				<div class="urlVideo">
				<input style="width: 100%;" id="url" type="text" placeholder="URL do vídeo aqui">
				<button id="enter">buscar vídeo</button>
				</div>
				<button id="download" onclick="downloadVideo(video.src)" type="video/mp4">DOWNLOAD NOW!!!</button>
				</video>
			</div>
			<div class="video-div">
				<video class="video-window" id="main-video" type="video/mp4" download></video>	

				<div class="video-options">
					<select id="vid-format">
						<option id="mp4" value="mp4">Mp4</option>
						<option id="mp3" value="mp3">Mp3</option>
					</select>
					<select id="vid-resolution">
						<option id="1080" value="1080p (HD)">1080p</option>
						<option id="720" value="720p">720p</option>
						<option id="480" value="480p">480p</option>
					<select>
				</div>
			</div>

			
</main>

		<script>	
			const video = document.getElementById("main-video");
			const downloadButt = document.getElementById("download");
			const inputText = document.getElementById("url");
			const inputButton = document.getElementById("enter");
			const url = `http://localhost:6969/video`;
			const formats = document.getElementById("vid-format");
			const resolutions = document.getElementById("vid-resolution");

			inputButton.addEventListener("click", getVideo, false);
			async function getVideo(){
				const CallServerVideo = await fetch(url, {
					method: 'POST',
					headers :{
						"Content-Type": 'application/json',
					},
					body: JSON.stringify({
						url: inputText.value,
						format: formats.options[ formats.selectedIndex ].value,
						resolution: resolutions.options[ resolutions.selectedIndex ].value
					})
				})
				.then(output => output.blob())
				.then(blob => {
					let file = window.URL.createObjectURL(blob);
					video.src = file;
				});
			}

			function downloadVideo(url){
			          const a = document.createElement('a')
		              	  a.href = url
				  a.download = url.split('/').pop()
				  document.body.appendChild(a)
				  a.click()
				  document.body.removeChild(a)
			}
		</script>
	</body>	
</html>
