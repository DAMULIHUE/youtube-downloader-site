<!DOCTYPE html>
<html>
	<head>
		<title> piracy huehuehue </title>
		<link rel="stylesheet" href="style.css">
	</head>

	<body>
		<main>
			<div class="insertURL">
				<div class="mainVid">
					<input class="input" id="url" type="text" placeholder="URL do vídeo aqui">
					<button id="enter">buscar vídeo</button>
				</div>
				<button id="download" onclick="downloadVideo(video.src)" type="video/mp4">DOWNLOAD NOW!!!</button>
				</video>
			</div>
			<div class="video-div">
				<video class="video-window" id="main-video" type="video/mp4" download></video>	

				<div class="video-options">
					<select id="file-format" autocomplete="off">
						<option id="mp4" value="mp4">Mp4</option>
						<option id="mp3" value="mp3">Mp3</option>
					</select>
					<select id="vid-resolution" autocomplete="off" tyle="display: none">
						<option id="1080" value="1080p">1080p</option>
						<option id="720" value="720p">720p</option>
						<option id="480" value="480p">480p</option>
					<select>
					<select id="aud-resolution" autocomplete="off" style="display: none">
						<option id="0" value="0">melhor qualidade</option>
						<option id="5" value="5">média qualidade</option>
						<option id="10" value="10">pior qualidade</option>
					</select>
				</div>
			</div>

			
</main>

		<script>	
			const video = document.getElementById("main-video");
			const downloadButt = document.getElementById("download");
			const inputText = document.getElementById("url");
			const inputButton = document.getElementById("enter");	
			
			// CONFIGS:
			//const url = `http://localhost:6969/video`;
			const formats = document.getElementById("file-format");
			let resolutionChose = "vid-resolution";
			let resolutions = document.getElementById(resolutionChose);
			
			formats.addEventListener("click", getFormat, false);
			function getFormat() {
				
				resolutions.style="display:none";

				switch(formats.options[ formats.selectedIndex ].value){
					case("mp4"):
						
						resolutions = document.getElementById("vid-resolution");
						break;
					case("mp3"):

						resolutions = document.getElementById("aud-resolution");
						
						break;
				}

				resolutions.style="display:flex";
			}
			
			inputButton.addEventListener("click", getVideo, false);
			async function getVideo(){
				const CallServerVideo = await fetch(`${window.location.href}video`, {
					method: 'POST',
					headers :{
						"Content-Type": 'application/json',
					},
					body: JSON.stringify({
						url: inputText.value,
						format: formats.options[ formats.selectedIndex ].value,
						quality: resolutions.options[ resolutions.selectedIndex ].value
					})
				})
				.then(output => output.blob())
				.then(blob => {
					let file = window.URL.createObjectURL(blob);
					video.src = file;
				});
			}

			function downloadVideo(url){
			          const a = document.createElement('a')
		              	  a.href = url
				  a.download = url.split('/').pop()
				  document.body.appendChild(a)
				  a.click()
				  document.body.removeChild(a)
			}
		</script>
	</body>	
</html>
